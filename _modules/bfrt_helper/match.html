

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>bfrt_helper.match &mdash; Barefoot Runtime gRPC Helper 1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/fonts.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/blockquote.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/font.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Barefoot Runtime gRPC Helper
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../overview.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview.html#installing">Installing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../overview.html#self-contained-usage">Self Contained Usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../overview.html#usage">Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../overview.html#basic-example">Basic Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../overview.html#retrieving-non-p4-configuration">Retrieving Non-P4 Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../overview.html#manipulating-non-match-action-tables">Manipulating Non-Match/Action Tables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../overview.html#building-documentation">Building Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../fields.html">Fields</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../fields.html#existing-fields">Existing Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../fields.html#defining-custom-fields">Defining Custom Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../fields.html#operations-on-fields">Operations on Fields</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../match.html">Match</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../match.html#exact">Exact</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../match.html#masked-matches-lpm-ternary">Masked Matches (LPM &amp; Ternary)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../match.html#construction">Construction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../match.html#operations">Operations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../match.html#unsupported-matches">Unsupported Matches</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples.html#loading-a-pipeline">Loading a Pipeline</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/bfrt_info.html">bfrt_helper.bfrt_info</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/bfrt_info.html#bfrtinfo">BfRtInfo</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/bfrt.html">bfrt_helper.bfrt</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/bfrt.html#bfrthelper">BfRtHelper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/bfrt.html#exceptions">Exceptions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/bfrt.html#unknownaction">UnknownAction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/bfrt.html#unknownactionparameter">UnknownActionParameter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/bfrt.html#unknowntable">UnknownTable</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/bfrt.html#unknownkeyfield">UnknownKeyField</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/bfrt.html#mismatchedmatchtype">MismatchedMatchType</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/bfrt.html#mismatcheddatasize">MismatchedDataSize</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/bfrt.html#invalidactionparameter">InvalidActionParameter</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/fields.html">bfrt_helper.fields</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/fields.html#base-fields">Base Fields</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/fields.html#jsonserialisable">JSONSerialisable</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fields.html#field">Field</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/fields.html#predefined-fields">Predefined Fields</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/fields.html#devport">DevPort</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fields.html#digesttype">DigestType</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fields.html#egressspec">EgressSpec</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fields.html#ipv4address">IPv4Address</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fields.html#layer2port">Layer2Port</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fields.html#macaddress">MACAddress</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fields.html#multicastgroupid">MulticastGroupId</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fields.html#multicastnodeid">MulticastNodeId</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fields.html#portid">PortId</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fields.html#replicationid">ReplicationId</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fields.html#stringfield">StringField</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fields.html#vlanid">VlanID</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/fields.html#exceptions">Exceptions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/fields.html#mismatchedkeys">MismatchedKeys</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/match.html">bfrt_helper.match</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/match.html#base-match-type">Base Match Type</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/match.html#masked">Masked</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/match.html#supported-types">Supported Types</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/match.html#exact">Exact</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/match.html#longestprefixmatch">LongestPrefixMatch</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/match.html#ternary">Ternary</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/match.html#exceptions">Exceptions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/match.html#mismatchedkeys">MismatchedKeys</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/util.html">bfrt_helper.util</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/util.html#functions">Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/util.html#encode-number">encode_number</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/util.html#bit-not">bit_not</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/util.html#mask-from-prefix">mask_from_prefix</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/util.html#exceptions">Exceptions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/util.html#invalidvalue">InvalidValue</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/util.html#invalidoperation">InvalidOperation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/util.html#valueoutofrange">ValueOutOfRange</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/util.html#matchhelper">MatchHelper</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Barefoot Runtime gRPC Helper</a>
        
      </nav>


      <div class="wy-nav-content">
<div class="git-ribbon">
  <a href="http://github.com/APS-Networks" rel="me">Join us on GitHub</a>
</div>

        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>bfrt_helper.match</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for bfrt_helper.match</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">bfrt_helper.util</span> <span class="kn">import</span> <span class="n">InvalidOperation</span>
<span class="kn">from</span> <span class="nn">bfrt_helper.util</span> <span class="kn">import</span> <span class="n">InvalidValue</span>
<span class="kn">from</span> <span class="nn">bfrt_helper.util</span> <span class="kn">import</span> <span class="n">mask_from_prefix</span>
<span class="kn">from</span> <span class="nn">bfrt_helper.fields</span> <span class="kn">import</span> <span class="n">Field</span>
<span class="kn">from</span> <span class="nn">bfrt_helper.fields</span> <span class="kn">import</span> <span class="n">IPv4Address</span>
<span class="kn">from</span> <span class="nn">bfrt_helper.fields</span> <span class="kn">import</span> <span class="n">MismatchedTypes</span>


<div class="viewcode-block" id="MismatchedKeys"><a class="viewcode-back" href="../../api/match.html#bfrt_helper.match.MismatchedKeys">[docs]</a><span class="k">class</span> <span class="nc">MismatchedKeys</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raised when the key&#39;s name doesn&#39;t match when comparing two match</span>
<span class="sd">    objects</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


<div class="viewcode-block" id="Masked"><a class="viewcode-back" href="../../api/match.html#bfrt_helper.match.Masked">[docs]</a><span class="k">class</span> <span class="nc">Masked</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Base class for all matches which can be represented in terms of a value</span>
<span class="sd">    and a mask.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Masked.subset_of"><a class="viewcode-back" href="../../api/match.html#bfrt_helper.match.Masked.subset_of">[docs]</a>    <span class="k">def</span> <span class="nf">subset_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;Masked&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Compares whether ``self`` is a subset of ``other``.</span>

<span class="sd">        If all the elements in ``self`` are also in ``other``, then this object</span>
<span class="sd">        is a subset. This is ``True`` even if both objects contain exactly the</span>
<span class="sd">        same elements.</span>

<span class="sd">        This is broadly equivalent to a ``&lt;=`` (less than or equal to)</span>
<span class="sd">        operation, and is called by the :py:meth:`Masked.__le__` special method.</span>

<span class="sd">        See also: :py:meth:`Masked.proper_subset_of`</span>

<span class="sd">        Args:</span>
<span class="sd">            other (Masked): Other masked value to compare against.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if ``self`` is subset of ``other``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">&amp;</span> <span class="n">other</span><span class="o">.</span><span class="n">mask</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">mask</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">&amp;</span> <span class="n">other</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">value</span> <span class="o">&amp;</span> <span class="n">other</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span></div>

<div class="viewcode-block" id="Masked.superset_of"><a class="viewcode-back" href="../../api/match.html#bfrt_helper.match.Masked.superset_of">[docs]</a>    <span class="k">def</span> <span class="nf">superset_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;Masked&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Compares whether ``other`` is a subset of ``self``.</span>

<span class="sd">        If all the elements in ``other`` are also in ``self``, then this object</span>
<span class="sd">        is a superset. This is ``True`` even if both objects contain exactly the</span>
<span class="sd">        same elements.</span>

<span class="sd">        This is broadly equivalent to a ``&gt;=`` (less than or equal to)</span>
<span class="sd">        operation, and is called by the :py:meth:`Masked.__ge__` special method.</span>

<span class="sd">        See also: :py:meth:`Masked.proper_superset_of`</span>

<span class="sd">        Args:</span>
<span class="sd">            other (Masked): Other masked value to compare against.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if ``self`` is superset of ``other``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">&amp;</span> <span class="n">other</span><span class="o">.</span><span class="n">mask</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">value</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span></div>

<div class="viewcode-block" id="Masked.proper_subset_of"><a class="viewcode-back" href="../../api/match.html#bfrt_helper.match.Masked.proper_subset_of">[docs]</a>    <span class="k">def</span> <span class="nf">proper_subset_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;Masked&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Compares with another match, where ``self`` is found to be a proper</span>
<span class="sd">        subset of the other.</span>

<span class="sd">        If all the elements in ``self`` are present in ``other``, and, ``other``</span>
<span class="sd">        contains at least one element not in ``self``, then this object can be</span>
<span class="sd">        considered a proper subset.</span>

<span class="sd">        This is broadly equivalent to a ``&lt;`` (less than) operation, and is</span>
<span class="sd">        called by the :py:meth:`Masked.__lt__` special method.</span>

<span class="sd">        See also: :py:meth:`Masked.subset_of`</span>

<span class="sd">        Args:</span>
<span class="sd">            other (Masked): Other masked value to compare against.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if ``self`` is proper superset of ``other``</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subset_of</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span></div>

<div class="viewcode-block" id="Masked.proper_superset_of"><a class="viewcode-back" href="../../api/match.html#bfrt_helper.match.Masked.proper_superset_of">[docs]</a>    <span class="k">def</span> <span class="nf">proper_superset_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;Masked&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Compares with another match, where ``self`` is found to be a proper</span>
<span class="sd">        superset of the other.</span>

<span class="sd">        If all the elements in ``other`` are present in ``self``, and, ``self``</span>
<span class="sd">        contains at least one element not in ``other``, then this object can be</span>
<span class="sd">        considered a proper superset.</span>

<span class="sd">        This is broadly equivalent to a ``&gt;`` (less than) operation, and is</span>
<span class="sd">        called by the :py:meth:`Masked.__gt__` special method.</span>

<span class="sd">        See also: :py:meth:`Masked.uperset_of`</span>

<span class="sd">        Args:</span>
<span class="sd">            other (Masked): Other masked value to compare against.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if ``self`` is proper superset of ``other``</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">superset_of</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span></div>

<div class="viewcode-block" id="Masked.intersection"><a class="viewcode-back" href="../../api/match.html#bfrt_helper.match.Masked.intersection">[docs]</a>    <span class="k">def</span> <span class="nf">intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;Masked&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Masked&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns the intersection of ``self`` and ``other``.</span>

<span class="sd">        The intersection of two masked values is the common potential values</span>
<span class="sd">        between ``self`` and ``other``.</span>

<span class="sd">        The following relations should hold true, noting the use of proper</span>
<span class="sd">        subset and superset comparisons:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            intersection = a &amp; b</span>
<span class="sd">            assert a &gt; intersection # Intersection is subset of a</span>
<span class="sd">            assert b &gt; intersection # Intersection also subset of b</span>

<span class="sd">        Since the intersection is the common elements, and if both a and b are</span>
<span class="sd">        proper supersets of the intersection, they must contain</span>
<span class="sd">        different/unique values.</span>

<span class="sd">        Returns:</span>

<span class="sd">            Masked: Contains the elements which are common to ``self`` and</span>
<span class="sd">            ``other``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">|</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">|</span> <span class="n">other</span><span class="o">.</span><span class="n">mask</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Masked.merged"><a class="viewcode-back" href="../../api/match.html#bfrt_helper.match.Masked.merged">[docs]</a>    <span class="k">def</span> <span class="nf">merged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;Masked&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Masked&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Derives a :py:class:`Masked` object whose mask has all &quot;don&#39;t care&quot; bits</span>
<span class="sd">        from both ``self`` and ``other``.</span>

<span class="sd">        .. note::</span>
<span class="sd">            This is *not* a union. As an example, a ternary expression</span>
<span class="sd">            :math:`A = 0101xxxx` contains all possible values beginning with</span>
<span class="sd">            :math:`0101`. Another value :math:`B = xxxx0101` contains all the</span>
<span class="sd">            possible values ending in :math:`0101`. A merge between the two</span>
<span class="sd">            yields the ternary expression :math:`I = xxxxxxxx`, where another</span>
<span class="sd">            value :math:`C = 11001100` is subset to :math:`I` but is in neither</span>
<span class="sd">            :math:`A` or :math:`B`. If it were a union, any value that is subset</span>
<span class="sd">            must be in either :math:`A` or :math`B`.</span>

<span class="sd">        Returns:</span>

<span class="sd">            Masked: Contains values derived from</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">&amp;</span> <span class="n">other</span><span class="o">.</span><span class="n">mask</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">&amp;</span> <span class="n">new_mask</span><span class="p">,</span> <span class="n">new_mask</span><span class="p">)</span></div>

<div class="viewcode-block" id="Masked.overlaps"><a class="viewcode-back" href="../../api/match.html#bfrt_helper.match.Masked.overlaps">[docs]</a>    <span class="k">def</span> <span class="nf">overlaps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;Masked&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns whether or not two ``Masked`` matches overlap.</span>

<span class="sd">        Overlapping ternary expressions are defined where some, but not all,</span>
<span class="sd">        elements in a ternary :math:`A` exist in a ternary :math:`B`, and, some,</span>
<span class="sd">        but not all, elements in :math:`B` exist in :math:`A`. That is to say</span>
<span class="sd">        that they are neither proper superset or subset of each other, but they</span>
<span class="sd">        share elements.</span>

<span class="sd">        If only one of these conditions held true, they would either be a proper</span>
<span class="sd">        subset or superset of one another. A corollary to this is that longest</span>
<span class="sd">        prefix matches do not overlap, they are strictly a subset or superset of</span>
<span class="sd">        one another.</span>

<span class="sd">        That is to say that :math:`A`, being a proper superset of the</span>
<span class="sd">        intersection :math:`I`, has at least one element not in :math:`I`, and,</span>
<span class="sd">        :math:`B`, being a proper superset of :math:`I`, has at least one</span>
<span class="sd">        element not in intersection :math:`I`, implying that the elements</span>
<span class="sd">        contained in the differences between either :math:`A` or :math:`B`</span>
<span class="sd">        and the intersection are unique to each other.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">&amp;</span> <span class="n">other</span><span class="o">.</span><span class="n">mask</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="n">c_mask</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="ow">or</span> <span class="n">c_mask</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">&amp;</span> <span class="n">c_mask</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span> <span class="o">&amp;</span> <span class="n">c_mask</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Hashes the value and mask of the match.</span>

<span class="sd">        This is useful if the expression is to be used as a key in a dictionary</span>
<span class="sd">        like object.</span>

<span class="sd">        Args:</span>

<span class="sd">            Masked:</span>

<span class="sd">        Returns:</span>

<span class="sd">            int: Hash of ``self.mask`` and ``self.value``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">))</span>

<div class="viewcode-block" id="Masked.__le__"><a class="viewcode-back" href="../../api/match.html#bfrt_helper.match.Masked.__le__">[docs]</a>    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;Masked&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;See :meth:`subset_of`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subset_of</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>

<div class="viewcode-block" id="Masked.__ge__"><a class="viewcode-back" href="../../api/match.html#bfrt_helper.match.Masked.__ge__">[docs]</a>    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;Masked&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;See :meth:`superset_of`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">superset_of</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>

<div class="viewcode-block" id="Masked.__lt__"><a class="viewcode-back" href="../../api/match.html#bfrt_helper.match.Masked.__lt__">[docs]</a>    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;Masked&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;See :meth:`proper_subset_of`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">proper_subset_of</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>

<div class="viewcode-block" id="Masked.__gt__"><a class="viewcode-back" href="../../api/match.html#bfrt_helper.match.Masked.__gt__">[docs]</a>    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;Masked&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;See :meth:`proper_superset_of`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">proper_superset_of</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>

<div class="viewcode-block" id="Masked.__eq__"><a class="viewcode-back" href="../../api/match.html#bfrt_helper.match.Masked.__eq__">[docs]</a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;Masked&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Equality compares two ternary expressions.</span>

<span class="sd">        If both value and mask are the same between the two objects, then</span>
<span class="sd">        ``True`` is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span></div>

<div class="viewcode-block" id="Masked.__and__"><a class="viewcode-back" href="../../api/match.html#bfrt_helper.match.Masked.__and__">[docs]</a>    <span class="k">def</span> <span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;Masked&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Masked&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns the intersection of ``self`` and ``other``.</span>

<span class="sd">        see :meth:`intersection`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>

<div class="viewcode-block" id="Masked.__or__"><a class="viewcode-back" href="../../api/match.html#bfrt_helper.match.Masked.__or__">[docs]</a>    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;Masked&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Masked&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a ternary with a merged mask of ``self`` and ``other``.</span>

<span class="sd">        see :meth:`merged`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">merged</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>

<div class="viewcode-block" id="Masked.__iter__"><a class="viewcode-back" href="../../api/match.html#bfrt_helper.match.Masked.__iter__">[docs]</a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Masked.__iter__.iterator&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Creates an `iterator` that returns consecutive elements in the set of</span>
<span class="sd">        ``Masked``, starting from the current value.</span>

<span class="sd">        The iterator itself is not efficient, it&#39;s internal value is incremented</span>
<span class="sd">        until it finds a match on every iteration.</span>

<span class="sd">        When the iterator is dereferenced, it returns either an LPM or Ternary</span>
<span class="sd">        expression, depending on what the derived class is.</span>

<span class="sd">        Examples:</span>

<span class="sd">            Using a ``PortID``:</span>

<span class="sd">                &gt;&gt;&gt; match = Ternary(PortId(0x0), mask=0xc)</span>
<span class="sd">                &gt;&gt;&gt; [str(x) for x in iter(match)]</span>
<span class="sd">                [</span>
<span class="sd">                    &#39;0x0 &amp;&amp;&amp; 0xf3&#39;,</span>
<span class="sd">                    &#39;0x4 &amp;&amp;&amp; 0xf3&#39;,</span>
<span class="sd">                    &#39;0x8 &amp;&amp;&amp; 0xf3&#39;,</span>
<span class="sd">                    &#39;0xc &amp;&amp;&amp; 0xf3&#39;</span>
<span class="sd">                ]</span>

<span class="sd">            Or an ``IPv4Address``:</span>

<span class="sd">                &gt;&gt;&gt; match = Ternary(IPv4Address(&quot;192.168.42.24&quot;),</span>
<span class="sd">                ..      mask=&quot;255.255.255.252&quot;)</span>
<span class="sd">                &gt;&gt;&gt; [str()]</span>
<span class="sd">                [</span>
<span class="sd">                    &#39;192.168.42.24 &amp;&amp;&amp; 255.255.255.252&#39;,</span>
<span class="sd">                    &#39;192.168.42.25 &amp;&amp;&amp; 255.255.255.252&#39;,</span>
<span class="sd">                    &#39;192.168.42.26 &amp;&amp;&amp; 255.255.255.252&#39;,</span>
<span class="sd">                    &#39;192.168.42.27 &amp;&amp;&amp; 255.255.255.252&#39;,</span>
<span class="sd">                ]</span>

<span class="sd">        Returns:</span>
<span class="sd">            An iterator object that</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">iterator</span><span class="p">(</span><span class="n">ternary</span><span class="p">):</span>
            <span class="n">global_max_value</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">bitwidth</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">local_max_val</span> <span class="o">=</span> <span class="n">global_max_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">value</span>
            <span class="n">local_max_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">value</span> <span class="o">|</span> <span class="n">local_max_val</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">value</span>

            <span class="n">match_cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
            <span class="n">value_cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="vm">__class__</span>
            <span class="k">yield</span> <span class="n">match_cls</span><span class="p">(</span><span class="n">value_cls</span><span class="p">(</span><span class="n">temp</span><span class="p">),</span> <span class="n">value_cls</span><span class="p">(</span><span class="n">global_max_value</span><span class="p">))</span>

            <span class="n">initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">value</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">value</span>
            <span class="k">while</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="n">local_max_val</span><span class="p">:</span>
                <span class="n">temp</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">temp</span> <span class="o">&amp;</span> <span class="n">mask</span> <span class="o">!=</span> <span class="n">initial</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">temp</span> <span class="o">&amp;</span> <span class="n">initial</span> <span class="o">!=</span> <span class="n">temp</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">match_cls</span><span class="p">(</span><span class="n">value_cls</span><span class="p">(</span><span class="n">temp</span><span class="p">),</span> <span class="n">value_cls</span><span class="p">(</span><span class="n">global_max_value</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">iterator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Ternary"><a class="viewcode-back" href="../../api/match.html#bfrt_helper.match.Ternary">[docs]</a><span class="k">class</span> <span class="nc">Ternary</span><span class="p">(</span><span class="n">Masked</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Matches values on specific bits.</span>

<span class="sd">    A ``Ternary`` match is a match type which matches on specific bits of the</span>
<span class="sd">    value. This is achieved by the use of a mask; when a match is performed,</span>
<span class="sd">    both the the expected value and the compared value are ANDed with the mask,</span>
<span class="sd">    and an equality operation can be performed without comparing every single</span>
<span class="sd">    bit.</span>

<span class="sd">    ``Ternary`` values are associated with TCAM () memory; and are stored in</span>
<span class="sd">    hardware as `trits`. These are like bits but have 3 states, on, off, and</span>
<span class="sd">    &quot;don&#39;t care&quot;.</span>

<span class="sd">    Note:</span>
<span class="sd">        Masks could be represented by either ``0`` or ``1`` for a match. In</span>
<span class="sd">        this case, ``1`` bits represent bit&#39;s which are matched against.</span>

<span class="sd">    This class represents a ternary expression as a combination of an integer</span>
<span class="sd">    value and a mask. This is because:</span>

<span class="sd">    * Python supports arbitrary length integers;</span>
<span class="sd">    * It is easier to perform bitwise operations on integers.</span>

<span class="sd">    Args:</span>
<span class="sd">        value (Field): The instance of a field, e.g. ``VlanID()``,</span>
<span class="sd">                ``MACAddress()``, etc.</span>
<span class="sd">        mask (Field): The mask representing the bits to match against, either as</span>
<span class="sd">                an instance of the value&#39;s type, or, a value that can be passed</span>
<span class="sd">                to that type&#39;s constructor.</span>
<span class="sd">        dont_care (bool): If ``True``, no bits will be considered.</span>

<span class="sd">    The semantics of this match can change depending on whether a mask or</span>
<span class="sd">    ``dont_care`` is specified. By default, creating a ``Ternary`` match</span>
<span class="sd">    without a ``mask`` will match on every single bit, effectively acting in the</span>
<span class="sd">    same way as :class:`bfrt_helper.match.Exact`.</span>

<span class="sd">    The mask value does not have to be specified explictly as the same type as</span>
<span class="sd">    the value, any value will be accepted so long as it would be accepted by</span>
<span class="sd">    the value types constructor.</span>

<span class="sd">    If ``dont_care`` is specified, no bits will be compared (i.e, the mask will</span>
<span class="sd">    contain all zeroes). This means that it will match on any value it&#39;s</span>
<span class="sd">    compared against. This can be useful if a `table` specifies multiple key</span>
<span class="sd">    fields, and you wanted to match on another field, but not this specific</span>
<span class="sd">    ``Ternary`` element.</span>

<span class="sd">    Examples:</span>
<span class="sd">        A match on a ``PortId`` which only considers the 4 least significant</span>
<span class="sd">        bits::</span>

<span class="sd">            my_field = Ternary(PortId(42), PortId(0xf))</span>

<span class="sd">        A match on a ``PortId`` which only considers the 4 least significant</span>
<span class="sd">        bits, but not specifying the mask in terms of the original type::</span>

<span class="sd">            my_field = Ternary(PortId(42), 0xf)</span>

<span class="sd">        A match that will match exactly on a ``PortId`` of 42::</span>

<span class="sd">            my_field = Ternary(PortId(42))</span>

<span class="sd">        A match that will match on any other ``PortId``::</span>

<span class="sd">            my_field = Ternary(PortId(42), dont_care=True)</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Field</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">Field</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dont_care</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">value</span><span class="o">.</span><span class="n">bitwidth</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span>

        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">required_bytes</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">bitwidth</span> <span class="o">+</span> <span class="mi">7</span><span class="p">)</span> <span class="o">//</span> <span class="mi">8</span>
            <span class="k">if</span> <span class="n">dont_care</span><span class="p">:</span>
                <span class="n">mask_int</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">mask_bytes</span> <span class="o">=</span> <span class="n">mask_int</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">required_bytes</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span><span class="p">)</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">mask_bytes</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mask_int</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">value</span><span class="o">.</span><span class="n">bitwidth</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">mask_bytes</span> <span class="o">=</span> <span class="n">mask_int</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">required_bytes</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span><span class="p">)</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">mask_bytes</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="n">mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span>

<div class="viewcode-block" id="Ternary.value_bytes"><a class="viewcode-back" href="../../api/match.html#bfrt_helper.match.Ternary.value_bytes">[docs]</a>    <span class="k">def</span> <span class="nf">value_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the match value as bytes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bytes: Internal value converted into bytes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">()</span></div>

<div class="viewcode-block" id="Ternary.mask_bytes"><a class="viewcode-back" href="../../api/match.html#bfrt_helper.match.Ternary.mask_bytes">[docs]</a>    <span class="k">def</span> <span class="nf">mask_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the mask value as bytes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bytes: Internal mask converted into bytes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">()</span></div>

<div class="viewcode-block" id="Ternary.dont_care"><a class="viewcode-back" href="../../api/match.html#bfrt_helper.match.Ternary.dont_care">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">dont_care</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Not implemented&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a string representation of the match.</span>

<span class="sd">        The string representation is output in terms of how this would be</span>
<span class="sd">        written in a P4 program. A value in P4 which is two numbers separated</span>
<span class="sd">        by a triple ampersand (in the correct context) is a ternary expression.</span>

<span class="sd">        Example:</span>

<span class="sd">            &gt;&gt;&gt; match = Ternary(PortId(0x42), 0x0f)</span>
<span class="sd">            &gt;&gt;&gt; str(match)</span>
<span class="sd">            0x42 &amp;&amp;&amp; 0xf</span>

<span class="sd">        Returns:</span>

<span class="sd">            str: String representation of the match in terms of how it would be</span>
<span class="sd">            written in P4.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2"> &amp;&amp;&amp; </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Ternary(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">, mask=</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span></div>


<div class="viewcode-block" id="LongestPrefixMatch"><a class="viewcode-back" href="../../api/match.html#bfrt_helper.match.LongestPrefixMatch">[docs]</a><span class="k">class</span> <span class="nc">LongestPrefixMatch</span><span class="p">(</span><span class="n">Masked</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class that represents only the first *prefix* bits are considered</span>
<span class="sd">    in a match.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Field</span><span class="p">,</span> <span class="n">prefix</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">prefix</span> <span class="o">&gt;</span> <span class="n">value</span><span class="o">.</span><span class="n">bitwidth</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Prefix </span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> is greater than the maximum allowed for &quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;this field. [bitwidth=</span><span class="si">{</span><span class="n">value</span><span class="o">.</span><span class="n">bitwidth</span><span class="si">}</span><span class="s2">]&quot;</span>
            <span class="k">raise</span> <span class="n">InvalidValue</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="vm">__class__</span><span class="p">((</span><span class="mi">2</span><span class="o">**</span><span class="n">prefix</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">bitwidth</span> <span class="o">-</span> <span class="n">prefix</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;LongestPrefixMatch(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">, prefix=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">)&quot;</span>

<div class="viewcode-block" id="LongestPrefixMatch.value_bytes"><a class="viewcode-back" href="../../api/match.html#bfrt_helper.match.LongestPrefixMatch.value_bytes">[docs]</a>    <span class="k">def</span> <span class="nf">value_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="Exact"><a class="viewcode-back" href="../../api/match.html#bfrt_helper.match.Exact">[docs]</a><span class="k">class</span> <span class="nc">Exact</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;An exact match</span>

<span class="sd">    Comparisons between exact matches are on the basis of equality alone.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="Exact.value_bytes"><a class="viewcode-back" href="../../api/match.html#bfrt_helper.match.Exact.value_bytes">[docs]</a>    <span class="k">def</span> <span class="nf">value_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">()</span></div></div>


<span class="k">class</span> <span class="nc">Key</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A collection of fields representing the key segment of a table defined in</span>
<span class="sd">    a P4 program.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">fields</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span>

    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See :meth:`proper_superset_of`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">proper_superset_of</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See :meth:`proper_subset_of`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">proper_subset_of</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See :meth:`superset_of`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">superset_of</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See :meth:`subset_of`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subset_of</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">equal_</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

    <span class="k">def</span> <span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__equality_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">v1</span><span class="p">),</span> <span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">other</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>

            <span class="k">if</span> <span class="n">k1</span> <span class="o">!=</span> <span class="n">k2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MismatchedKeys</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Key </span><span class="si">{</span><span class="n">k1</span><span class="si">}</span><span class="s2"> is not equal to </span><span class="si">{</span><span class="n">k2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">v2</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">MismatchedTypes</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Type of </span><span class="si">{</span><span class="n">v1</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span><span class="si">}</span><span class="s2">) is not equal to </span><span class="si">{</span><span class="n">v2</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">conflicts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="n">acc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__equality_check</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">v1</span><span class="p">),</span> <span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">other</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">Masked</span><span class="p">):</span>
                <span class="n">acc</span> <span class="o">=</span> <span class="n">acc</span> <span class="ow">and</span> <span class="n">v1</span><span class="o">.</span><span class="n">conflicts</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">acc</span> <span class="o">=</span> <span class="n">acc</span> <span class="ow">and</span> <span class="n">v1</span> <span class="o">==</span> <span class="n">v2</span>
        <span class="k">return</span> <span class="n">acc</span>

    <span class="k">def</span> <span class="nf">intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the intersection of values between two matches.</span>

<span class="sd">        Raises:</span>
<span class="sd">            MismatchedKeys:</span>
<span class="sd">                Raised if a key does not match it&#39;s respective compared match.</span>
<span class="sd">                Implies that match fields must be ordered correctly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__equality_check</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">v1</span><span class="p">),</span> <span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">other</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">Ternary</span><span class="p">):</span>
                <span class="c1"># args.append(v1.intersection(v2))</span>
                <span class="n">args</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">LongestPrefixMatch</span><span class="p">):</span>
                <span class="c1"># args.append(LongestPrefixMatch(v1.value | v2.value, max(v1.prefix,</span>
                <span class="c1">#   v2.prefix)))</span>
                <span class="n">args</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">=</span> <span class="n">LongestPrefixMatch</span><span class="p">(</span>
                    <span class="n">v1</span><span class="o">.</span><span class="n">value</span> <span class="o">|</span> <span class="n">v2</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">v1</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span> <span class="n">v2</span><span class="o">.</span><span class="n">prefix</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v1</span> <span class="o">!=</span> <span class="n">v2</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">InvalidOperation</span><span class="p">(</span>
                        <span class="s2">&quot;Trying to calculate the difference &quot;</span>
                        <span class="s2">&quot;on matches containing non-equal exact values.&quot;</span>
                    <span class="p">)</span>
                <span class="n">args</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v1</span>
        <span class="k">return</span> <span class="n">Key</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">superset_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates whether one match is a superset of another</span>

<span class="sd">        For this to hold true, all fields must be superset of their compared</span>
<span class="sd">        respective fields.</span>

<span class="sd">        See :meth:`Masked.superset_of`.</span>

<span class="sd">        Raises:</span>
<span class="sd">            MismatchedKeys:</span>
<span class="sd">                Raised if a key does not match it&#39;s respective compared match.</span>
<span class="sd">                Implies that match fields must be ordered correctly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">acc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__equality_check</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">v1</span><span class="p">),</span> <span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">other</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">Masked</span><span class="p">):</span>
                <span class="n">acc</span> <span class="o">=</span> <span class="n">acc</span> <span class="ow">and</span> <span class="n">v1</span> <span class="o">&gt;=</span> <span class="n">v2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">acc</span> <span class="o">=</span> <span class="n">acc</span> <span class="ow">and</span> <span class="n">v1</span> <span class="o">==</span> <span class="n">v2</span>
        <span class="k">return</span> <span class="n">acc</span>

    <span class="k">def</span> <span class="nf">subset_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates whether one match is a superset of another</span>

<span class="sd">        For this to hold _true,_ all fields must be subset of their compared</span>
<span class="sd">        respective fields.</span>

<span class="sd">        See :meth:`Masked.subset_of`.</span>

<span class="sd">        Raises:</span>
<span class="sd">            MismatchedKeys:</span>
<span class="sd">                Raised if a key does not match it&#39;s respective compared match.</span>
<span class="sd">                Implies that match fields must be ordered correctly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">acc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__equality_check</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">v1</span><span class="p">),</span> <span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">other</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">Masked</span><span class="p">):</span>
                <span class="n">acc</span> <span class="o">=</span> <span class="n">acc</span> <span class="ow">and</span> <span class="n">v1</span> <span class="o">&lt;=</span> <span class="n">v2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">acc</span> <span class="o">=</span> <span class="n">acc</span> <span class="ow">and</span> <span class="n">v1</span> <span class="o">==</span> <span class="n">v2</span>
        <span class="k">return</span> <span class="n">acc</span>

    <span class="k">def</span> <span class="nf">proper_superset_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates whether one match is a proper superset of another</span>

<span class="sd">        For this to hold true, all fields must be proper superset of their</span>
<span class="sd">        compared respective fields.</span>

<span class="sd">        See :meth:`Masked.proper_superset_of`.</span>

<span class="sd">        Raises:</span>
<span class="sd">            MismatchedKeys:</span>
<span class="sd">                Raised if a key does not match it&#39;s respective compared match.</span>
<span class="sd">                Implies that match fields must be ordered correctly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">acc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__equality_check</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">v1</span><span class="p">),</span> <span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">other</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">Masked</span><span class="p">):</span>
                <span class="n">acc</span> <span class="o">=</span> <span class="n">acc</span> <span class="ow">and</span> <span class="n">v1</span> <span class="o">&gt;</span> <span class="n">v2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">acc</span> <span class="o">=</span> <span class="n">acc</span> <span class="ow">and</span> <span class="n">v1</span> <span class="o">==</span> <span class="n">v2</span>
        <span class="k">return</span> <span class="n">acc</span>

    <span class="k">def</span> <span class="nf">proper_subset_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates whether one match is a proper superset of another</span>

<span class="sd">        For this to hold true, all fields must be proper superset of their</span>
<span class="sd">        compared respective fields.</span>

<span class="sd">        See :meth:`Masked.subset_of`.</span>

<span class="sd">        Raises:</span>
<span class="sd">            MismatchedKeys:</span>
<span class="sd">                Raised if a key does not match it&#39;s respective compared match.</span>
<span class="sd">                Implies that match fields must be ordered correctly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">acc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__equality_check</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">v1</span><span class="p">),</span> <span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">other</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">Masked</span><span class="p">):</span>
                <span class="n">acc</span> <span class="o">=</span> <span class="n">acc</span> <span class="ow">and</span> <span class="n">v1</span> <span class="o">&lt;</span> <span class="n">v2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">acc</span> <span class="o">=</span> <span class="n">acc</span> <span class="ow">and</span> <span class="n">v1</span> <span class="o">==</span> <span class="n">v2</span>
        <span class="k">return</span> <span class="n">acc</span>
        <span class="c1"># return acc</span>

    <span class="k">def</span> <span class="nf">equal_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates whether two matches are equal.</span>

<span class="sd">        For this to hold true, every single element must equal it&#39;s other.</span>

<span class="sd">        Raises:</span>
<span class="sd">            MismatchedKeys:</span>
<span class="sd">                Raised if a key does not match it&#39;s respective compared match.</span>
<span class="sd">                Implies that match fields must be ordered correctly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">acc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__equality_check</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">v1</span><span class="p">),</span> <span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">other</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>

            <span class="n">acc</span> <span class="o">=</span> <span class="n">acc</span> <span class="ow">and</span> <span class="n">v1</span> <span class="o">==</span> <span class="n">v2</span>
        <span class="k">return</span> <span class="n">acc</span>

    <span class="k">def</span> <span class="nf">overlaps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">acc</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__equality_check</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">v1</span><span class="p">),</span> <span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">other</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">Masked</span><span class="p">):</span>
                <span class="n">acc</span> <span class="o">=</span> <span class="n">acc</span> <span class="ow">and</span> <span class="p">(</span><span class="n">v1</span> <span class="o">&gt;=</span> <span class="n">v2</span> <span class="ow">or</span> <span class="n">v1</span> <span class="o">&lt;=</span> <span class="n">v2</span> <span class="ow">or</span> <span class="n">v1</span><span class="o">.</span><span class="n">overlaps</span><span class="p">(</span><span class="n">v2</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">acc</span> <span class="o">=</span> <span class="n">acc</span> <span class="ow">and</span> <span class="n">v1</span> <span class="o">==</span> <span class="n">v2</span>
        <span class="k">return</span> <span class="n">acc</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">field_strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Ternary</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">field_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">field_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">field_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot;{{  </span><span class="si">{}</span><span class="s2">  }}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">field_strings</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">acc</span> <span class="o">=</span> <span class="s2">&quot;Match(&quot;</span>
        <span class="n">acc</span> <span class="o">+=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">=</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot;&#39;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="k">return</span> <span class="n">acc</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>


<span class="k">class</span> <span class="nc">IPv4AddressTernary</span><span class="p">(</span><span class="n">Ternary</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A helper class for more easily expressing a ternary ``IPv4Address``.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dont_care</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">IPv4Address</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">IPv4Address</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">IPv4Address</span><span class="p">(</span><span class="n">mask_from_prefix</span><span class="p">(</span><span class="n">IPv4Address</span><span class="o">.</span><span class="n">bitwidth</span><span class="p">,</span> <span class="n">prefix</span><span class="p">))</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">dont_care</span><span class="p">)</span>

    <span class="c1"># def __str__(self):</span>
    <span class="c1">#     print(&#39;IPv4AddressTernary.__str__&#39;)</span>
    <span class="c1">#     if self.mask.value == self.max_value:</span>
    <span class="c1">#         return str(self.value)</span>
    <span class="c1">#     return f&quot;{str(self.value)} &amp;&amp;&amp; {str(self.mask)}&quot;</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021 - present, APS Networks GmbH.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>