

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Overview &mdash; Barefoot Runtime gRPC Helper 1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="_static/fonts.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/blockquote.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/font.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Fields" href="fields.html" />
    <link rel="prev" title="Barefoot Runtime gRPC Helper" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Barefoot Runtime gRPC Helper
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installing">Installing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#self-contained-usage">Self Contained Usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basic-example">Basic Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#retrieving-non-p4-configuration">Retrieving Non-P4 Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#manipulating-non-match-action-tables">Manipulating Non-Match/Action Tables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#building-documentation">Building Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fields.html">Fields</a><ul>
<li class="toctree-l2"><a class="reference internal" href="fields.html#existing-fields">Existing Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="fields.html#defining-custom-fields">Defining Custom Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="fields.html#operations-on-fields">Operations on Fields</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="match.html">Match</a><ul>
<li class="toctree-l2"><a class="reference internal" href="match.html#exact">Exact</a></li>
<li class="toctree-l2"><a class="reference internal" href="match.html#masked-matches-lpm-ternary">Masked Matches (LPM &amp; Ternary)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="match.html#construction">Construction</a></li>
<li class="toctree-l3"><a class="reference internal" href="match.html#operations">Operations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="match.html#unsupported-matches">Unsupported Matches</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="examples.html#loading-a-pipeline">Loading a Pipeline</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api/bfrt_info.html">bfrt_helper.bfrt_info</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api/bfrt_info.html#bfrtinfo">BfRtInfo</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api/bfrt.html">bfrt_helper.bfrt</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api/bfrt.html#bfrthelper">BfRtHelper</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/bfrt.html#exceptions">Exceptions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/bfrt.html#unknownaction">UnknownAction</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/bfrt.html#unknownactionparameter">UnknownActionParameter</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/bfrt.html#unknowntable">UnknownTable</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/bfrt.html#unknownkeyfield">UnknownKeyField</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/bfrt.html#mismatchedmatchtype">MismatchedMatchType</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/bfrt.html#mismatcheddatasize">MismatchedDataSize</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/bfrt.html#invalidactionparameter">InvalidActionParameter</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api/fields.html">bfrt_helper.fields</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api/fields.html#base-fields">Base Fields</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/fields.html#jsonserialisable">JSONSerialisable</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/fields.html#field">Field</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/fields.html#predefined-fields">Predefined Fields</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/fields.html#devport">DevPort</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/fields.html#digesttype">DigestType</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/fields.html#egressspec">EgressSpec</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/fields.html#ipv4address">IPv4Address</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/fields.html#layer2port">Layer2Port</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/fields.html#macaddress">MACAddress</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/fields.html#multicastgroupid">MulticastGroupId</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/fields.html#multicastnodeid">MulticastNodeId</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/fields.html#portid">PortId</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/fields.html#replicationid">ReplicationId</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/fields.html#stringfield">StringField</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/fields.html#vlanid">VlanID</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/fields.html#exceptions">Exceptions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/fields.html#mismatchedkeys">MismatchedKeys</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api/match.html">bfrt_helper.match</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api/match.html#base-match-type">Base Match Type</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/match.html#masked">Masked</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/match.html#supported-types">Supported Types</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/match.html#exact">Exact</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/match.html#longestprefixmatch">LongestPrefixMatch</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/match.html#ternary">Ternary</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/match.html#exceptions">Exceptions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/match.html#mismatchedkeys">MismatchedKeys</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api/util.html">bfrt_helper.util</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api/util.html#functions">Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/util.html#encode-number">encode_number</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/util.html#bit-not">bit_not</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/util.html#mask-from-prefix">mask_from_prefix</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/util.html#exceptions">Exceptions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/util.html#invalidvalue">InvalidValue</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/util.html#invalidoperation">InvalidOperation</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/util.html#valueoutofrange">ValueOutOfRange</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/util.html#matchhelper">MatchHelper</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Barefoot Runtime gRPC Helper</a>
        
      </nav>


      <div class="wy-nav-content">
<div class="git-ribbon">
  <a href="http://github.com/APS-Networks" rel="me">Join us on GitHub</a>
</div>

        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Overview</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/overview.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h1>
<p>The motivation for this library is to provide an easy way of interacting with
Intel® Tofino™ based devices exposing a Barefoot Runtime gRPC interface.</p>
<ul class="simple">
<li><p>It provides useful examples for interacting with such an interface;</p></li>
<li><p>It can be used in a self-contained Python virtual environment, without any
dependency on an installed SDE, and as such can be used remotely. It does
however require the protobuf definition.</p></li>
<li><p>While the SDE does come packaged with it’s own client, there is little in the
way of documentation, and it’s not obvious how this is installed.</p></li>
</ul>
<p>There are four main components to the library:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">BfRtInfo</span></code> object which is responsible for parsing the <code class="docutils literal notranslate"><span class="pre">bfrt.json</span></code>
information file. This is not generally intended for direct use. After all,
it is essentially a transformation of a JSON document.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">BfRtHelper</span></code> which creates gRPC requests;</p></li>
<li><p>The collection of <code class="docutils literal notranslate"><span class="pre">Field</span></code> objects which represents the data types that can
be sent to a device;</p></li>
<li><p>And finally the <code class="docutils literal notranslate"><span class="pre">Match</span></code> objects which represents that combination of fields
and match types that can be supplied to a P4 table.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>This documentation is incomplete. If you have any questions or would like
to see something added, please contact <script type="text/javascript">document.write(
    "<n pynff=\"ersrerapr rkgreany\" uers=\"znvygb:fhccbeg\100ncf-argjbexf\056pbz\">fhccbeg\100ncf-argjbexf\056pbz<\057n>".replace(/[a-zA-Z]/g,
        function(c){
            return String.fromCharCode(
                (c<="Z"?90:122)>=(c=c.charCodeAt(0)+13)?c:c-26
            );
        }
    )
);</script>.</p></li>
<li><p>Please note that at this time we are unable to accept pull requests as
APS Networks is reserving the right to dual licence this library. Any
contributions would therefore have to be issued with a rights assignment.</p></li>
</ul>
</div>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>The requirements should be handled by the pip install process. However, Python 3
is required.</p>
</section>
<section id="installing">
<h2>Installing<a class="headerlink" href="#installing" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Copy the BfRt Protobuf definition into <code class="docutils literal notranslate"><span class="pre">proto/bfrt_helper/pb2</span></code>.</p></li>
<li><p>From the root of the project, run <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code>.</p></li>
</ol>
<section id="self-contained-usage">
<h3>Self Contained Usage<a class="headerlink" href="#self-contained-usage" title="Permalink to this headline">¶</a></h3>
<p>It is possible to use this library without respect to an existing Python
installation using a <em>virtual environment</em>. This may be desirable if the
system Python installation contains conflicting libraries, <code class="docutils literal notranslate"><span class="pre">gRPC</span></code> and friends
being a highly likely one.</p>
<p>The following script creates a Python virtual environment in the root of the
project directory, with the Python “sysroot” being located in
<code class="docutils literal notranslate"><span class="pre">${project_root}/.venv</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="si">${</span><span class="nv">project_root</span><span class="si">}</span>

<span class="c1"># Creates the virtual environment</span>
python3 -m venv .venv

<span class="c1"># Sets the current shell to use the new environment&#39;s Python installation.</span>
<span class="c1"># That first period is super important.</span>
. ./.venv/bin/activate

pip install .
</pre></div>
</div>
<p>If wishing to continue to use the current shell, but want to go back to the
system Python:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>deactivate
</pre></div>
</div>
</section>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<section id="basic-example">
<h3>Basic Example<a class="headerlink" href="#basic-example" title="Permalink to this headline">¶</a></h3>
<p>Taking a hypothetical program called <cite>port_forward</cite> which directs packets based
on the input port to an output port, we can create the appropriate request with
the following example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">DEVICE_ID</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">CLIENT_ID</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">INGRESS_PORT</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">EGRESS_PORT</span> <span class="o">=</span> <span class="mi">64</span>

<span class="n">bfrt_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;bfrt.json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="n">bfrt_info</span> <span class="o">=</span> <span class="n">BfRtInfo</span><span class="p">(</span><span class="n">bfrt_data</span><span class="p">)</span>
<span class="n">bfrt_helper</span> <span class="o">=</span> <span class="n">BfRtHelper</span><span class="p">(</span><span class="n">DEVICE_ID</span><span class="p">,</span> <span class="n">CLIENT_ID</span><span class="p">,</span> <span class="n">bfrt_info</span><span class="p">)</span>

<span class="n">write_request</span> <span class="o">=</span> <span class="n">bfrt_helper</span><span class="o">.</span><span class="n">create_table_write</span><span class="p">(</span>
    <span class="n">program_name</span><span class="o">=</span><span class="s1">&#39;forwarder&#39;</span><span class="p">,</span>
    <span class="n">table_name</span><span class="o">=</span><span class="s1">&#39;pipe.PortForward.destination_port&#39;</span><span class="p">,</span>
    <span class="n">key</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;ig_intr_md.ingress_port&#39;</span><span class="p">:</span> <span class="n">Exact</span><span class="p">(</span><span class="n">PortId</span><span class="p">(</span><span class="n">INGRESS_PORT</span><span class="p">))</span>
    <span class="p">},</span>
    <span class="n">action_name</span><span class="o">=</span><span class="s1">&#39;PortForward.forward&#39;</span><span class="p">,</span>
    <span class="n">action_params</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;egress_port&#39;</span><span class="p">:</span> <span class="n">PortId</span><span class="p">(</span><span class="n">EGRESS_PORT</span><span class="p">),</span>
    <span class="p">})</span>
</pre></div>
</div>
<blockquote class="pull-quote">
<div><p><code class="docutils literal notranslate"><span class="pre">ig_intr_md</span></code> is an argument passed to the ingress controller by the
Tofino model; it is a shortening of “ingress intrinsic metadata”, and
funnily enough, contains metadata specific to the ingress. The name it’s
given is one that is found throughout Intel’s P4 examples. If you were to
declare it with a different name, you would have to update it here.</p>
</div></blockquote>
<p>Running through the code, we open our BfRt file, and construct a <code class="docutils literal notranslate"><span class="pre">BfRtInfo</span></code>
object with it, using it to construct the helper object along with the
device and client ID.</p>
<p>You should be able to see that this is completely independent of any kind
of gRPC client. This may be useful if you want to verify bf runtime gRPC
objects without having to connect to a device (and consequently manage
the stream channel, messages across the device, subscription requests etc).</p>
</section>
<section id="retrieving-non-p4-configuration">
<h3>Retrieving Non-P4 Configuration<a class="headerlink" href="#retrieving-non-p4-configuration" title="Permalink to this headline">¶</a></h3>
<p>It is possible to retrieve from the device non-P4 tables, which can be merged
with the runtime configuration to provide a more complete view of the state of
a device.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">request</span> <span class="o">=</span> <span class="n">bfrt_helper</span><span class="o">.</span><span class="n">create_get_pipeline_request</span><span class="p">()</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">GetForwardingPipelineConfig</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

<span class="n">program_name</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">p4_name</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">non_p4_config</span><span class="o">.</span><span class="n">bfruntime_info</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
<span class="n">non_p4_config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">p4_config</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">program_name</span> <span class="o">==</span> <span class="n">config</span><span class="o">.</span><span class="n">p4_name</span><span class="p">:</span>
        <span class="n">p4_config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">bfruntime_info</span><span class="p">)</span>
        <span class="n">p4_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tables&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">non_p4_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tables&quot;</span><span class="p">))</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;all.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
    <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">p4_config</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="manipulating-non-match-action-tables">
<h3>Manipulating Non-Match/Action Tables<a class="headerlink" href="#manipulating-non-match-action-tables" title="Permalink to this headline">¶</a></h3>
<p>As mentioned previously, some non-P4 tables can be retrieved from the device.
For a subset of these, it is also possible to manipulate them. These can be used
to add/alter copy to cpu settings, multicast groups, port settings etc.</p>
<p>While these tables can be considered as “ordinary” database tables, they are
still manipulated by the same mechanisms as a match-action update.</p>
<p>While this is not guaranteed to work (or indeed supported by Intel), what
follows is an example of creating a request to add a <code class="docutils literal notranslate"><span class="pre">copy_to_cpu</span></code>
configuration:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Assuming bfrt_helper et. al. have been created prior</span>

<span class="n">port</span> <span class="o">=</span> <span class="mi">64</span>

<span class="n">bfrt_request</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">create_write_request</span><span class="p">(</span><span class="n">program_name</span><span class="p">)</span>
<span class="n">bfrt_table_entry</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">create_table_entry</span><span class="p">(</span><span class="s2">&quot;$pre.port&quot;</span><span class="p">)</span>

<span class="c1"># The first argument is the table name, the second the field to write, and</span>
<span class="c1"># the final is the value to lookup</span>
<span class="c1">#                                         table        key name    key value</span>
<span class="n">bfrt_key_field</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">create_key_field</span><span class="p">(</span><span class="s2">&quot;$pre.port&quot;</span><span class="p">,</span> <span class="s2">&quot;$DEV_PORT&quot;</span><span class="p">,</span> <span class="n">Exact</span><span class="p">(</span><span class="n">port</span><span class="p">))</span>
<span class="n">bfrt_table_entry</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">bfrt_key_field</span><span class="p">])</span>

<span class="n">info_cpu_port_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bfrt_info</span><span class="o">.</span><span class="n">get_data_field</span><span class="p">(</span>
<span class="c1">#   table         field</span>
    <span class="s2">&quot;$pre.port&quot;</span><span class="p">,</span> <span class="s2">&quot;$COPY_TO_CPU_PORT_ENABLE&quot;</span>
<span class="p">)</span>

<span class="n">bfrt_cpu_port_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_data_field</span><span class="p">(</span>
    <span class="n">info_cpu_port_field</span><span class="o">.</span><span class="n">singleton</span><span class="p">,</span> <span class="kc">True</span>
<span class="p">)</span>
<span class="n">bfrt_table_entry</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">bfrt_cpu_port_field</span><span class="p">])</span>

<span class="n">bfrt_update</span> <span class="o">=</span> <span class="n">bfrt_request</span><span class="o">.</span><span class="n">updates</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
<span class="n">bfrt_update</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">bfruntime_pb2</span><span class="o">.</span><span class="n">Update</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">MODIFY</span>
<span class="n">bfrt_update</span><span class="o">.</span><span class="n">entity</span><span class="o">.</span><span class="n">table_entry</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">bfrt_table_entry</span><span class="p">)</span>
</pre></div>
</div>
<p>For information on tables that may be modifiable, look at the non-P4 config for
fields which have the <code class="docutils literal notranslate"><span class="pre">&quot;read_only&quot;:</span> <span class="pre">true</span></code> attribute.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You modify other tables at your peril. The extent to which you can alter the
behaviour of the device is not well understood. It may be possible to
cause the ASIC to function incorrectly.</p>
</div>
</section>
</section>
<section id="building-documentation">
<h2>Building Documentation<a class="headerlink" href="#building-documentation" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This documentation is built by
<a class="reference external" href="https://www.sphinx-doc.org/en/master/">Sphinx</a></p>
</div>
<p>Outside of GitHub, there are a few ways in which this documentation can be
built and viewed. A script has been provided which is capable of building the
documentation for you, at <cite>${project_root}/scripts/build-docs.sh</cite>. This sets up
a Python virtual environment, installing the necessary dependencies along the
way. The output of this script will place the resultant web site pages at
``</p>
<p>can be done with a handy
1-liner:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./scripts/build-docs.sh <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="nb">cd</span> docs/_build/html <span class="o">&amp;&amp;</span> python3 -m http.server<span class="o">)</span>
</pre></div>
</div>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="fields.html" class="btn btn-neutral float-right" title="Fields" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="Barefoot Runtime gRPC Helper" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021 - present, APS Networks GmbH.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>